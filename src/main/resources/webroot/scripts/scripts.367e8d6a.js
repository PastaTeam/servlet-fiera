"use strict";angular.module("fieraApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngMaterial","angularMoment"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/aziende/:id_azienda/:id_prodotto?",{templateUrl:"views/aziende.html",controller:"AziendeCtrl"}).when("/register",{templateUrl:"views/register.html",controller:"RegisterCtrl"}).when("/prodotti/new",{templateUrl:"views/product.html",controller:"ProductCtrl"}).otherwise({redirectTo:"/"})}]).config(["$mdThemingProvider",function(a){a.theme("admin").primaryPalette("indigo").accentPalette("pink").warnPalette("red"),a.setDefaultTheme("admin"),a.alwaysWatchTheme(!0)}]).config(["ConfigProvider",function(a){a.serverVersion="api",a.serverHost="http://localhost:8080",a.authTokenName="x-authorization-token"}]),angular.module("fieraApp").provider("Config",function(){this.serverVersion=null,this.serverHost=null,this.authTokenName=null;var a=!1;this.clientVersion="{{VERSION}}";var b="Uninitialized config server values";this.$get=function(){var c=this;return{getServerPath:function(){if(!c.serverHost||!c.serverVersion)throw b;return c.serverHost+"/"+c.serverVersion+"/"},getAuthTokenName:function(){if(!c.authTokenName)throw b;return c.authTokenName},getVersion:function(){return c.clientVersion},mockResources:function(){return a}}}}),angular.module("fieraApp").controller("MainCtrl",["$scope","$rootScope","$location","AziendeService",function(a,b,c,d){a.aziende=[],a.loading=!0,b.$emit("loading-start"),d.getListaAziende().then(function(c){a.aziende=c,b.$emit("loading-stop"),a.loading=!1},function(){b.$emit("loading-stop"),a.loading=!1}),a.goToAzienda=function(a){c.path("/aziende/"+a)},b.$emit("page-title","Dashboard")}]),angular.module("fieraApp").controller("SidenavCtrl",["$scope","$mdMedia","$mdDialog","$mdSidenav","$mdTheming","$mdMenu","$location","Config","$rootScope","AuthService",function(a,b,c,d,e,f,g,h,i,j){a.customFullscreen=b("xs")||b("sm"),a.authService=j,a.account={},a.$watch(j.getLoginResponse,function(b){b?a.account=b.account:a.account={}}),a.closed=!1,i.$on("sidenav-close",function(){a.closed=!0}),i.$on("sidenav-toggle",function(){a.closed=!a.closed}),i.$on("sidenav-open",function(){a.closed=!1}),a.openAccountMenu=function(a,b){a.open(b)},a.menuEntries=[{title:"Lista Aziende",icon:"library_books",link:"/"},{title:"Aggiungi Prodotto",icon:"library_add",link:"/prodotti/new",restrict:["azienda"]},{title:"Registrati",icon:"assignment",link:"/register",restrict:["guest"]},{title:"Accedi",icon:"fingerprint",link:"/login",restrict:["guest"]}],a.canShow=function(a){return a.restrict?a.restrict.every(function(a){return a==j.getRole()}):!0},a.logout=function(a,b){j.logout().then(function(){g.path("/")}),d("left").close()},a.handleClick=function(b,c){b.link?a.goTo(b.link):"function"==typeof b.callback&&b.callback(b,c),d("left").close()},a.goTo=function(a){g.path(a)}}]),angular.module("fieraApp").controller("ToolbarCtrl",["$scope","$mdSidenav","$rootScope",function(a,b,c){var d=null;a.pageTitle="",c.$on("page-title",function(b,c){a.pageTitle=c}),a.openSidenav=function(){b("left").open()},a.hide=!1,a.loading=!1,c.$on("toolbar-hide",function(){a.hide=!0}),c.$on("toolbar-toggle",function(){a.hide=!a.hide}),c.$on("toolbar-show",function(){a.hide=!1}),c.$on("loading-start",function(b,c){c&&(d=c),a.loading=!0}),c.$on("loading-stop",function(){a.loading=!1}),c.$on("loading-toggle",function(){a.loading=!a.loading}),c.getClickEvent=function(){return d}}]),angular.module("fieraApp").controller("LoginCtrl",["$scope","$rootScope","AuthService","$location",function(a,b,c,d){return c.isLogged()?void d.path("/"):(a.error=null,a.loading=!1,a.user={email:"",password:"",type:"persona"},a.login=function(){a.loading=!0,a.error=null,c.login(a.user.email,a.user.password,a.user.type).then(function(){a.loading=!1,d.path("/")},function(b){a.error=b,a.loading=!1})},void b.$emit("page-title","Login"))}]),angular.module("fieraApp").controller("AziendeCtrl",["$scope","$rootScope","$location","ProdottiService","$routeParams","AuthService","CommentiService","$mdDialog",function(a,b,c,d,e,f,g,h){a.prodotti=[],a.loading=!0,b.$emit("loading-start"),a.isLogged=f.isLogged()&&"persona"==f.getRole(),console.log(f.getRole()),e.id_prodotto?(a.id_prodotto=e.id_prodotto,b.$emit("page-title","Prodotto"),a.commenti=[],a.prodotto={},d.getProdotto(e.id_prodotto).then(function(c){a.prodotto=c,b.$emit("loading-stop"),a.loading=!1},function(){b.$emit("loading-stop"),a.loading=!1}),g.getCommentiProdotto(e.id_prodotto).then(function(b){a.commenti=b}),a.openComment=function(b){var c=h.prompt().title("Commenta").textContent("Aggiungi un commento a questo prodotto").placeholder("Commento").targetEvent(b).ok("Salva").cancel("Annulla");h.show(c).then(function(b){return a.commenti.unshift({persona:{nome:f.getLoginResponse().account.first_name,cognome:f.getLoginResponse().account.last_name},commento:b}),g.addCommento(b,e.id_prodotto)})}):(d.getListaProdotti(e.id_azienda).then(function(c){a.prodotti=c,b.$emit("loading-stop"),a.loading=!1},function(){b.$emit("loading-stop"),a.loading=!1}),a.goToProdotto=function(a){c.path("/aziende/"+e.id_azienda+"/"+a)},b.$emit("page-title","Lista Prodotti"))}]),angular.module("fieraApp").controller("RegisterCtrl",["$scope","$rootScope","AuthService","$location",function(a,b,c,d){a.error=null,a.loading=!1,a.user={name:"",surname:"",email:"",password:"",type:"persona"},a.register=function(){a.loading=!0,a.error=null;var b=null;b="persona"==a.user.type?c.registerPersona(a.user.name,a.user.surname,a.user.email,a.user.password):c.registerAzienda(a.user.name,a.user.email,a.user.password),b.then(function(){a.loading=!1,d.path("/login")},function(b){a.error=b,a.loading=!1})},b.$emit("page-title","Registrazione")}]),angular.module("fieraApp").controller("ProductCtrl",["$scope","$rootScope","ProdottiService","AuthService","$location",function(a,b,c,d,e){return d.isLogged()?(a.error=null,a.loading=!1,a.product={name:"",description:""},a.add=function(){a.loading=!0,a.error=null;var b=c.addProdotto(a.product.name,a.product.description);b.then(function(){a.loading=!1,e.path("/login")},function(b){a.error=b,a.loading=!1})},void b.$emit("page-title","Aggiungi Prodotto")):void e.path("/")}]),angular.module("fieraApp").service("ResourcesGeneratorService",["Config","$resource","$q","$mdDialog","$rootScope",function(a,b,c,d,e){var f={data:{},code:{409:"Conflitto nella creazione della risorsa",404:"Risorsa non trovata",403:"Accesso negato",401:"Permessi insufficienti per accedere alla risorsa",400:"Parametri mancanti"}};this.getResource=function(c,d){var e={};return null!=c&&(e[a.getAuthTokenName()]=c),a.mockResources()?b("/mock/"+d+"-:mockMethod.json",{},{get:{method:"GET",headers:e,params:{mockMethod:"GET"}},save:{method:"GET",headers:e,params:{mockMethod:"POST"}},post:{method:"GET",headers:e,params:{mockMethod:"POST"}},put:{method:"GET",headers:e,params:{mockMethod:"PUT"}},query:{method:"GET",isArray:!0,headers:e,params:{mockMethod:"GET"}},remove:{method:"GET",headers:e,params:{mockMethod:"DELETE"}},"delete":{method:"GET",headers:e,params:{mockMethod:"DELETE"}}}):b(a.getServerPath()+d,{},{get:{method:"GET",headers:e},save:{method:"POST",headers:e},post:{method:"POST",headers:e},put:{method:"PUT",headers:e,params:{}},query:{method:"GET",isArray:!0,headers:e},remove:{method:"DELETE",headers:e},"delete":{method:"DELETE",headers:e}})},this.successHandler=function(a){return a},this.failureHandler=function(a){e.$emit("loading-stop");var b=null;return a&&a.data&&void 0!=a.data.error&&(b=f.data[a.data.error]),b||(b=f.code[a.status]),d.show(d.alert().clickOutsideToClose(!0).title("An error occurred").textContent(b).ariaLabel("Error message").ok("Close").targetEvent(e.getClickEvent()).theme(e.theme)),c.reject(b||a)}}]),angular.module("fieraApp").service("AuthService",["ResourcesGeneratorService","$q","$window","$location",function(a,b,c,d){var e=c.localStorage.getItem("authToken"),f=null,g=!1,h={account:{email:"Guest User",role:"guest"}},i="guest";this.getLoginResponse=function(){return h},this.isLogged=function(){return g},this.getAuthToken=function(){return e},this.hasAuthToken=function(){return void 0!=e&&null!=e},this.getUserId=function(){return f},this.getRole=function(){return i},this.login=function(d,j,k){return a.getResource(null,"login").save({email:d,password:j,type:k}).$promise.then(function(a){return a.error?b.reject(a.error):(c.localStorage.setItem("authToken",a.token),e=a.token,f=a.id,i=a.account.role,g=!0,h=a,a)},function(a){return c.localStorage.removeItem("authToken"),e=null,g=!1,b.reject(a.data)})},this.registerPersona=function(c,d,e,f){return a.getResource(null,"register/persona").save({nome:c,cognome:d,email:e,password:f}).$promise.then(function(a){return a.error?b.reject(a.error):a},function(a){return b.reject(a.data)})},this.registerAzienda=function(c,d,e){return a.getResource(null,"register/azienda").save({nome:c,email:d,password:e}).$promise.then(function(a){return a.error?b.reject(a.error):a},function(a){return b.reject(a.data)})},this.logout=function(){return e&&g?a.getResource(e,"logout").get().$promise.then(function(a){return c.localStorage.removeItem("authToken"),e=null,i="guest",g=!1,h={account:{email:"Guest User",role:"guest"}},a},function(a){return b.reject(a.data)}):b.reject("null authToken")},this.getSessionInfo=function(){return e?a.getResource(e,"info").get().$promise.then(function(a){return a.error?b.reject(a.error):(g=!0,h=a,i=a.account.role,f=a.id,a)},function(a){return g=!1,b.reject(a.data)}):b.reject("null authToken")},this.goToLogin=function(){d.path("/login")}}]),angular.module("fieraApp").service("AziendeService",["ResourcesGeneratorService",function(a){this.getListaAziende=function(){return a.getResource(null,"aziende").query().$promise.then(a.successHandler,a.failureHandler)}}]),angular.module("fieraApp").service("ProdottiService",["ResourcesGeneratorService","AuthService","$q",function(a,b,c){this.addProdotto=function(d,e){return b.isLogged()&&"azienda"==b.getRole()?a.getResource(b.getAuthToken(),"prodotti").save({nome:d,descrizione:e}).$promise.then(a.successHandler,a.failureHandler):c.reject("Invalid session or role")},this.getListaProdotti=function(b){return a.getResource(null,"prodotti").query({azienda:b}).$promise.then(a.successHandler,a.failureHandler)},this.getProdotto=function(b){return a.getResource(null,"prodotti/:id").get({id:b}).$promise.then(a.successHandler,a.failureHandler)}}]),angular.module("fieraApp").service("CommentiService",["ResourcesGeneratorService","AuthService",function(a,b){this.getCommentiProdotto=function(b){return a.getResource(null,"commenti/:id").query({id:b}).$promise.then(a.successHandler,a.failureHandler)},this.addCommento=function(c,d){return b.isLogged()&&"persona"==b.getRole()?a.getResource(b.getAuthToken(),"commenti").save({commento:c,prodotto:d}).$promise.then(a.successHandler,a.failureHandler):$q.reject("Invalid session or role")}}]),angular.module("fieraApp").directive("ngBlockies",["$mdColors",function(a){function b(b,c){function d(b){if(void 0==b||""==b)c.addClass("account-circle"),c.css({"background-image":""});else{var d=blockies.create({seed:b,color:a.getThemeColor("primary"),bgcolor:a.getThemeColor("accent"),spotcolor:"white",size:12,scale:12}).toDataURL();c.removeClass("account-circle"),c.css({"background-image":"url("+d+")"})}}b.$watch(function(){return b.seed()},function(){d(b.seed())})}return{link:b,restrict:"A",scope:{seed:"&ngBlockies"}}}]),angular.module("fieraApp").directive("passwordConfirm",function(){function a(a,b,c,d){d.$validators.mismatch=function(b){return b===a.firstPassword()}}return{link:a,restrict:"A",require:"ngModel",scope:{firstPassword:"&passwordConfirm"}}}),angular.module("fieraApp").run(["$templateCache",function(a){a.put("views/aziende.html",'<div layout="row"> <md-card flex="100" ng-if="!id_prodotto"> <md-card-header style="padding-bottom: 0"> <md-card-avatar> <md-icon class="md-user-avatar">library_books</md-icon> </md-card-avatar> <md-card-header-text> <span class="md-title">Lista prodotti</span> <span class="md-subhead">Seleziona un prodotto per commentarlo</span> </md-card-header-text> </md-card-header> <md-card-content style="padding: 0"> <md-list flex> <md-list-item ng-repeat="prodotto in prodotti" ng-click="goToProdotto(prodotto.ID);"> <md-icon>book</md-icon> <p>{{prodotto.nome}}</p> </md-list-item> </md-list> </md-card-content> </md-card> <md-card flex="100" ng-if="id_prodotto"> <md-card-header style="padding-bottom: 0"> <md-card-avatar> <md-icon class="md-user-avatar">book</md-icon> </md-card-avatar> <md-card-header-text> <span class="md-title">{{prodotto.nome}}</span> <span class="md-subhead">{{prodotto.azienda.nome}}</span> </md-card-header-text> </md-card-header> <md-card-content style="padding: 0"> <div style="padding: 0 16px"> <p style="margin-bottom: 0"> {{prodotto.descrizione}} </p> <h3 style="margin-bottom: 0">Commenti</h3> </div> <md-list flex> <md-list-item ng-if="isLogged" ng-click="openComment($event);" class="md-2-line"> <md-icon>add_circle</md-icon> <div class="md-list-item-text"> <h3>Nuovo commento</h3> <p>Aggiungi un commento a questo prodotto</p> </div> </md-list-item> <md-list-item ng-repeat="commento in commenti" class="md-2-line"> <md-icon>comment</md-icon> <div class="md-list-item-text"> <h3>{{commento.persona.nome}} {{commento.persona.cognome}}</h3> <p>{{commento.commento}}</p> </div> </md-list-item> </md-list> </md-card-content> </md-card> </div>'),a.put("views/login.html",'<h1 class="sign-in-title md-headline">Accedi</h1> <div layout="row"> <md-card id="login-card" flex-gt-xs="50" flex="100" flex-gt-md="30"> <md-card-content> <form name="loginForm"> <md-input-container class="md-block no-bottom-margin"> <label>Email</label> <input name="email" ng-model="user.email" required> <div ng-messages="loginForm.email.$error"> <div ng-message="required">Completa questo campo</div> </div> </md-input-container> <md-input-container class="md-block no-bottom-margin"> <label>Password</label> <input name="password" ng-model="user.password" type="password" required> <div ng-messages="loginForm.password.$error"> <div ng-message="required">Completa questo campo</div> </div> </md-input-container> <p>Tipo di accesso:</p> <md-input-container class="md-block no-bottom-margin"> <md-radio-group ng-model="user.type"> <md-radio-button value="persona" class="md-primary"> Persona </md-radio-button> <md-radio-button value="azienda" class="md-primary"> Azienda </md-radio-button> </md-radio-group> </md-input-container> </form> <p ng-if="error">{{error.error}}</p> </md-card-content> <md-card-actions layout="row" layout-align="end center"> <md-button class="md-raised md-primary button-100" ng-click="login();" ng-disabled="loading || loginForm.$invalid "> <span ng-if="!loading">Accedi</span> <md-progress-circular md-mode="indeterminate" ng-if="loading" class="button-loading"></md-progress-circular> </md-button> </md-card-actions> </md-card> </div>'),a.put("views/main.html",'<div layout="row"> <md-card flex="100"> <md-card-header style="padding-bottom: 0"> <md-card-avatar> <md-icon class="md-user-avatar">library_books</md-icon> </md-card-avatar> <md-card-header-text> <span class="md-title">Lista aziende</span> <span class="md-subhead">Seleziona un\'azienda per visualizzare i prodotti</span> </md-card-header-text> </md-card-header> <md-card-content style="padding: 0"> <md-list flex> <md-list-item ng-repeat="azienda in aziende" ng-click="goToAzienda(azienda.ID);"> <md-icon>book</md-icon> <p>{{azienda.nome}}</p> </md-list-item> </md-list> </md-card-content> </md-card> </div>'),a.put("views/product.html",'<h1 class="sign-in-title md-headline">Aggiungi Prodotto</h1> <div layout="row"> <md-card id="product-card" flex-gt-xs="50" flex="100" flex-gt-md="30"> <md-card-content> <form name="productForm"> <md-input-container class="md-block no-bottom-margin"> <label>Nome</label> <input name="name" ng-model="product.name" required> <div ng-messages="productForm.name.$error"> <div ng-message="required">Completa questo campo</div> </div> </md-input-container> <md-input-container class="md-block no-bottom-margin"> <label>Descrizione</label> <input name="descrizione" ng-model="product.description" required> <div ng-messages="productForm.description.$error"> <div ng-message="required">Completa questo campo</div> </div> </md-input-container> </form> <p ng-if="error">{{error}}</p> </md-card-content> <md-card-actions layout="row" layout-align="end center"> <md-button class="md-raised md-primary button-100" ng-click="add();" ng-disabled="loading || registerForm.$invalid "> <span ng-if="!loading">Aggiungi prodotto</span> <md-progress-circular md-mode="indeterminate" ng-if="loading" class="button-loading"></md-progress-circular> </md-button> </md-card-actions> </md-card> </div>'),a.put("views/register.html",'<h1 class="sign-in-title md-headline">Registrati</h1> <div layout="row"> <md-card id="register-card" flex-gt-xs="50" flex="100" flex-gt-md="30"> <md-card-content> <form name="registerForm"> <p>Tipo di utente:</p> <md-input-container class="md-block no-bottom-margin"> <md-radio-group ng-model="user.type"> <md-radio-button value="persona" class="md-primary"> Persona </md-radio-button> <md-radio-button value="azienda" class="md-primary"> Azienda </md-radio-button> </md-radio-group> </md-input-container> <md-input-container class="md-block no-bottom-margin"> <label>Nome</label> <input name="name" ng-model="user.name" required> <div ng-messages="registerForm.name.$error"> <div ng-message="required">Completa questo campo</div> </div> </md-input-container> <md-input-container ng-if="user.type == \'persona\'" class="md-block no-bottom-margin"> <label>Cognome</label> <input name="name" ng-model="user.surname" required> <div ng-messages="registerForm.name.$error"> <div ng-message="required">Completa questo campo</div> </div> </md-input-container> <md-input-container class="md-block no-bottom-margin"> <label>Email</label> <input name="email" ng-model="user.email" required> <div ng-messages="registerForm.email.$error"> <div ng-message="required">Completa questo campo</div> </div> </md-input-container> <md-input-container class="md-block no-bottom-margin"> <label>Password</label> <input name="password" ng-model="user.password" required> <div ng-messages="registerForm.password.$error"> <div ng-message="required">Completa questo campo</div> </div> </md-input-container> </form> <p ng-if="error">{{error.error}}</p> </md-card-content> <md-card-actions layout="row" layout-align="end center"> <md-button class="md-raised md-primary button-100" ng-click="register();" ng-disabled="loading || registerForm.$invalid "> <span ng-if="!loading">Registrati</span> <md-progress-circular md-mode="indeterminate" ng-if="loading" class="button-loading"></md-progress-circular> </md-button> </md-card-actions> </md-card> </div>')}]);